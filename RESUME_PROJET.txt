================================================================================
                    DOCUMENTATION MINI FACEBOOK - SYMFONY
================================================================================

üìã CE QUI A √âT√â FAIT
================================================================================

1. SYST√àME D'AUTHENTIFICATION
   - Inscription avec email, pr√©nom, nom, mot de passe
   - Connexion/d√©connexion s√©curis√©e
   - Protection des routes par Symfony Security

2. SYST√àME DE POSTS
   - Cr√©ation, affichage et suppression de posts
   - Affichage filtr√© : uniquement les posts de vos amis (et les v√¥tres)
   - Syst√®me de likes (j'aime) avec toggle
   - Syst√®me de commentaires sur les posts

3. SYST√àME D'AMITI√â
   - Recherche d'utilisateurs par nom, pr√©nom ou email
   - Envoi de demandes d'amiti√©
   - Acceptation/rejet de demandes en attente
   - Liste d'amis avec suppression
   - V√©rification que les utilisateurs sont amis pour certaines actions

4. SYST√àME DE MESSAGERIE PRIV√âE
   - Conversations entre amis uniquement
   - Envoi et r√©ception de messages
   - Marquage des messages comme lus/non lus
   - Interface de conversation avec historique

================================================================================
COMMENT FONCTIONNE SYMFONY
================================================================================

Symfony suit le pattern MVC (Model-View-Controller) :

1. Routing : Symfony route les requ√™tes HTTP vers les bons contr√¥leurs
2. Controller : Traite la logique m√©tier, appelle les services
3. Entity (Model) : Repr√©sente les donn√©es de la base de donn√©es
4. Repository : G√®re les requ√™tes SQL personnalis√©es
5. Template (View) : Affiche les donn√©es √† l'utilisateur avec Twig

Flux typique :
Requ√™te HTTP ‚Üí Routing ‚Üí Controller ‚Üí Entity/Repository ‚Üí Template ‚Üí R√©ponse HTML

================================================================================
FICHIERS CL√âS DU PROJET
================================================================================

1. CONFIGURATION
--------------------------------------------------------------------------------

config/packages/security.yaml
- Configure la s√©curit√© et l'authentification
- D√©finit qui peut acc√©der √† quelles routes (ROLE_USER, PUBLIC_ACCESS)
- G√®re le hashage des mots de passe

config/packages/doctrine.yaml
- Configuration de la base de donn√©es MySQL
- Configuration de Doctrine ORM (Object-Relational Mapping)

.env.local
- Variables d'environnement locales (non versionn√©es)
- DATABASE_URL : connexion MySQL (test1)
- APP_SECRET : cl√© secr√®te pour les tokens

--------------------------------------------------------------------------------

2. ENTIT√âS (MODELS) - Base de Donn√©es
--------------------------------------------------------------------------------

src/Entity/User.php
- Repr√©sente un utilisateur
- Champs : id, email, password (hash√©), firstname, lastname, roles
- Relations : posts, comments, likes, friendships, sentMessages, receivedMessages
- IMPORTANT : Impl√©mente UserInterface pour l'authentification Symfony

src/Entity/Post.php
- Repr√©sente une publication
- Champs : id, content, createdAt, author (relation vers User)
- Relations : comments (commentaires), likes (j'aime)
- M√©thodes : getLikesCount(), isLikedBy(User)

src/Entity/Comment.php
- Repr√©sente un commentaire sur un post
- Champs : id, content, createdAt
- Relations : post et author (User)

src/Entity/Like.php
- Repr√©sente un "j'aime" sur un post
- Relations : user et post
- IMPORTANT : Contrainte unique pour √©viter les likes en double

src/Entity/Friendship.php
- G√®re les relations d'amiti√© entre utilisateurs
- Champs : id, status (pending/accepted/blocked), createdAt
- Relations : user (celui qui envoie) et friend (celui qui re√ßoit)
- IMPORTANT : Contrainte unique pour √©viter les doublons

src/Entity/Message.php
- Repr√©sente un message priv√©
- Champs : id, content, createdAt, isRead (bool√©en)
- Relations : sender et receiver (tous deux User)

--------------------------------------------------------------------------------

3. REPOSITORIES - Requ√™tes Base de Donn√©es
--------------------------------------------------------------------------------

src/Repository/UserRepository.php
- Requ√™tes SQL personnalis√©es pour les utilisateurs
- M√©thode upgradePassword() : r√©hasher les mots de passe

src/Repository/PostRepository.php
- findAllOrderedByDate() : r√©cup√®re tous les posts tri√©s par date

src/Repository/FriendshipRepository.php
- findFriendship(User, User) : trouve une relation entre deux utilisateurs
- findFriends(User) : liste tous les amis accept√©s d'un utilisateur
- findPendingRequests(User) : liste les demandes en attente

src/Repository/MessageRepository.php
- findConversation(User1, User2) : r√©cup√®re tous les messages entre deux users
- findUnreadMessages(User) : messages non lus
- findConversationPartners(User) : liste des personnes avec qui on a des conversations

--------------------------------------------------------------------------------

4. CONTROLLERS - Logique M√©tier
--------------------------------------------------------------------------------

src/Controller/SecurityController.php
Routes : /register, /login, /logout
- G√®re l'inscription, la connexion et la d√©connexion
- IMPORTANT : Hash le mot de passe avant de sauvegarder l'utilisateur

src/Controller/PostController.php
Routes : /, /post/new, /post/{id}, /post/{id}/delete
- G√®re les posts : cr√©ation, affichage, suppression
- LOGIQUE IMPORTANTE : Filtre les posts pour n'afficher que ceux des amis

src/Controller/CommentController.php
Routes : /post/{id}/comment, /comment/{id}/delete
- Ajoute et supprime des commentaires sur les posts

src/Controller/LikeController.php
Route : /post/{id}/like
- Like/Unlike un post (toggle) - ajoute ou retire le like

src/Controller/FriendshipController.php
Routes : /friends, /friends/search, /friends/request/{id}, /friends/accept/{id}, etc.
- G√®re toutes les fonctionnalit√©s d'amiti√© : recherche, demande, acceptation, rejet, suppression

src/Controller/MessageController.php
Routes : /messages, /messages/conversation/{id}, /messages/send/{id}
- G√®re les conversations et l'envoi de messages
- LOGIQUE IMPORTANTE : V√©rifie que les utilisateurs sont amis avant d'autoriser les messages

--------------------------------------------------------------------------------

5. FORMS - Formulaires Symfony
--------------------------------------------------------------------------------

src/Form/RegistrationFormType.php
- Cr√©e le formulaire d'inscription
- Champs : email, firstname, lastname, plainPassword (RepeatedType)
- Validation : Email valide, mot de passe minimum 6 caract√®res

src/Form/PostType.php
- Formulaire pour cr√©er un post
- Champs : content (textarea)

src/Form/CommentType.php
- Formulaire pour ajouter un commentaire
- Champs : content (textarea)

src/Form/MessageType.php
- Formulaire pour envoyer un message
- Champs : content (textarea)

--------------------------------------------------------------------------------

6. TEMPLATES (VIEWS) - Interface Utilisateur
--------------------------------------------------------------------------------

templates/base.html.twig
- Template de base pour toutes les pages
- Contient : Navbar, menu de navigation, gestion des messages flash
- Utilise Bootstrap pour le design

templates/security/login.html.twig et register.html.twig
- Pages d'authentification : formulaires de connexion/inscription

templates/post/index.html.twig
- Page d'accueil affichant les posts
- Liste des posts avec boutons like/commentaire, formulaires de commentaires

templates/friendship/index.html.twig
- Liste des amis et demandes en attente
- Deux colonnes : amis accept√©s + demandes en attente

templates/friendship/search.html.twig
- Recherche d'utilisateurs
- Barre de recherche + r√©sultats avec bouton "Ajouter comme ami"

templates/message/index.html.twig
- Liste des conversations
- Liste des personnes avec qui on a des messages

templates/message/conversation.html.twig
- Page de conversation avec un utilisateur
- Messages affich√©s + formulaire pour envoyer un nouveau message
- JavaScript pour auto-scroll vers le bas

--------------------------------------------------------------------------------

7. MIGRATIONS - Base de Donn√©es
--------------------------------------------------------------------------------

migrations/Version20260110210633.php
- Premi√®re migration cr√©ant les tables : user, post, comment, like

migrations/Version20260110221800.php
- Migration ajoutant les tables : friendship et message

Comment fonctionnent les migrations :
- Doctrine g√©n√®re automatiquement le SQL √† partir des entit√©s
- Permet de versionner la structure de la base de donn√©es
- Commande : php bin/console doctrine:migrations:migrate

================================================================================
FLUX DE FONCTIONNEMENT - EXEMPLE CR√âER UN POST
================================================================================

1. Requ√™te HTTP : GET /post/new
2. Routing : Symfony trouve la route et appelle PostController::new()
3. Controller : 
   - Cr√©e un objet Post vide
   - Cr√©e un formulaire PostType li√© √† cet objet
   - Affiche le template post/new.html.twig
4. Template : L'utilisateur remplit le formulaire et clique "Publier"
5. Requ√™te HTTP : POST /post/new avec les donn√©es du formulaire
6. Controller : 
   - Re√ßoit les donn√©es via $form->handleRequest($request)
   - Valide avec $form->isValid()
   - Si valide : sauvegarde avec $entityManager->persist($post) et flush()
   - Redirige vers la page d'accueil
7. Template : Affiche un message de succ√®s

================================================================================
EXEMPLE SYST√àME D'AMITI√â
================================================================================

1. Utilisateur A recherche Utilisateur B sur /friends/search
2. Utilisateur A clique "Ajouter comme ami" ‚Üí POST /friends/request/{id}
3. FriendshipController::request() :
   - V√©rifie qu'il n'y a pas d√©j√† de relation
   - Cr√©e une entit√© Friendship avec status='pending'
   - Sauvegarde en base
4. Utilisateur B va sur /friends et voit la demande en attente
5. Utilisateur B clique "Accepter" ‚Üí POST /friends/accept/{id}
6. Le status de la Friendship passe √† 'accepted'
7. Maintenant, ils peuvent voir leurs posts mutuels et s'envoyer des messages

================================================================================
STRUCTURE BASE DE DONN√âES
================================================================================

Tables principales :

- user : Utilisateurs (email, password hash√©, pr√©nom, nom, roles)
- post : Posts (contenu, date, auteur)
- comment : Commentaires (contenu, date, post, auteur)
- like : Likes (user, post) avec contrainte unique
- friendship : Relations d'amiti√© (user, friend, status)
- message : Messages priv√©s (sender, receiver, contenu, date, isRead)

Relations cl√©s :
- Un User peut avoir plusieurs Posts, Comments, Likes, Friendships, Messages
- Un Post appartient √† un User et peut avoir plusieurs Comments et Likes
- Une Friendship lie deux Users avec un status (pending/accepted)
- Un Message a un sender et un receiver (tous deux User)

================================================================================
COMMANDES SYMFONY UTILES
================================================================================

php bin/console make:migration          # Cr√©er une migration
php bin/console doctrine:migrations:migrate  # Appliquer les migrations
php bin/console debug:router           # Voir toutes les routes
php bin/console cache:clear            # Vider le cache
php bin/console make:entity            # Cr√©er une entit√©
php bin/console make:controller        # Cr√©er un contr√¥leur
php -S localhost:8000 -t public        # D√©marrer le serveur

================================================================================
CONCEPTS SYMFONY IMPORTANTS
================================================================================

1. DEPENDENCY INJECTION
   - Symfony injecte automatiquement les services dans les contr√¥leurs
   - Exemple : EntityManagerInterface $entityManager est automatiquement fourni

2. DOCTRINE ORM
   - Transforme les entit√©s PHP en tables SQL
   - G√®re les relations entre entit√©s automatiquement
   - √âvite d'√©crire du SQL manuellement

3. TWIG (Moteur de Templates)
   - Syntaxe : {{ variable }}, {% if condition %}, {% for item in items %}
   - √âvite le m√©lange PHP/HTML
   - Permet l'h√©ritage de templates (extends)

4. FORM COMPONENT
   - Cr√©e automatiquement les formulaires HTML
   - Valide les donn√©es
   - G√®re le CSRF (protection contre les attaques)

5. SECURITY COMPONENT
   - G√®re l'authentification (login/logout)
   - Autorisation (qui peut acc√©der √† quoi)
   - Hashage des mots de passe automatique

================================================================================
S√âCURIT√â IMPL√âMENT√âE
================================================================================

1. Hashage des mots de passe : UserPasswordHasherInterface
2. Protection CSRF : Tous les formulaires ont un token CSRF
3. Autorisation : Routes prot√©g√©es avec #[IsGranted('ROLE_USER')]
4. Validation : Contraintes sur les entit√©s (NotBlank, Email, Length)
5. V√©rification d'amiti√© : Messages uniquement entre amis accept√©s

================================================================================
POINTS D'ATTENTION
================================================================================

- Cache Symfony : Si vous modifiez les entit√©s, pensez √† vider le cache
- Migrations : Toujours cr√©er une migration apr√®s modification d'entit√©
- Relations Doctrine : Bien d√©finir inversedBy et mappedBy pour les relations
- Validation : Les contraintes sont v√©rifi√©es automatiquement par Symfony
- Environment : .env.local est ignor√© par Git (variables sensibles)

================================================================================
R√âSUM√â TECHNIQUES
================================================================================

Framework : Symfony 8.0
Base de donn√©es : MySQL (test1)
Interface : Bootstrap 5
Moteur de templates : Twig
ORM : Doctrine

Date de cr√©ation : Janvier 2026

================================================================================
